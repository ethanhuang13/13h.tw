---
layout: post
title: iOS ä¹Ÿæœ‰æ·±è‰²æ¨¡å¼â€”æ™ºæ…§å‹åç›¸
---
2016 å¹´ï¼ŒApple çµ¦ tvOS 10 å¢åŠ äº†æ·±è‰²ä¸»é¡Œè¨­å®šï¼ˆ[`UIUserInterfaceStyle`](https://developer.apple.com/documentation/uikit/uiuserinterfacestyle)*ï¼‰ã€2018 å¹´ macOS åœ¨ Mojave ä¹Ÿæ–°å¢äº†æ·±è‰²æ¨¡å¼ï¼Œç”šè‡³é€£ Safari/WebKit éƒ½å¯ä»¥å‘Šè¨´ç¶²ç«™å»æ”¯æ´æ·±è‰²æ¨¡å¼ï¼ˆ[`prefers-color-scheme`](https://webkit.org/blog/8475/release-notes-for-safari-technology-preview-68/)ï¼‰ã€‚ä½†æ˜¯ iOS ä¸€ç›´æ²’æœ‰å…¨ç³»çµ±çš„æ·±è‰²ä¸»é¡Œæˆ–è¨­å®šã€‚

ç”±æ–¼ iOS çš„ UI é è¨­éƒ½æ˜¯ç™½åº•é»‘å­—æˆ–äº®è‰²ç³»ï¼Œå¤§éƒ¨åˆ† app å¦‚æœä¸ç‰¹åˆ¥è¨­è¨ˆæ·±è‰²ä¸»é¡Œçš„è©±ä¹Ÿå°±æœƒæ˜¯æ·ºè‰²ï¼Œæ‰€ä»¥**æŠŠè¢å¹•é¡è‰²åéä¾†**å°±æ˜¯ä¸€å€‹å»ºç«‹æ·±è‰²æ¨¡å¼çš„æ€è·¯ğŸ’¡ã€‚

ä½†æ˜¯å‚³çµ±çš„è¢å¹•åç›¸ï¼Œå°±æ˜¯å–®ç´”åœ°æŠŠè¼¸å‡ºåˆ°è¢å¹•çš„é¡è‰²åéä¾†ã€é»‘ç™½äº’æ›ï¼Œé¡ä¼¼æ–¼å‚³çµ±åº•ç‰‡çš„æ•ˆæœã€‚é‡åˆ°åœ–ç‰‡å°±æœƒæ…˜ä¸å¿ç¹ğŸ˜‚ã€‚ç›´æ¥æ‹¿ä¾†ç•¶æ·±è‰²æ¨¡å¼æ˜¯ä¸å ªç”¨çš„ã€‚

> è¢å¹•é¡è‰²åç›¸çš„è¨­å®šåœ¨è¼”åŠ©ä½¿ç”¨è£¡é¢å­˜åœ¨å·²ä¹…ï¼Œä½†æ˜¯æˆ‘å”¯ä¸€è½éçš„ä½¿ç”¨æƒ…å¢ƒï¼Œå°±æ˜¯é‚„åœ¨ç”¨å‚³çµ±åº•ç‰‡çš„æ”å½±å¸«ï¼Œç”¨ç›¸æ©Ÿ app æ­é…åç›¸æ¨¡å¼ä¾†çœ‹å¥¹æ²–æ´—å¥½çš„è² ç‰‡ã€‚

---
ä¸é iOS 11 æ–°å¢äº†**æ™ºæ…§å‹åç›¸**è¼”åŠ©åŠŸèƒ½ã€‚æ™ºæ…§å‹åç›¸æŠŠ iOS ä¸»ç•«é¢èˆ‡ app icon ä¿ç•™åŸæœ¬çš„é…è‰²ï¼Œåªæ˜¯ç¨å¾®é™ä½é£½å’Œåº¦ã€‚åŒæ™‚ï¼Œ**app å¯ä»¥æŒ‡å®šå¿½ç•¥å“ªäº› UI å…ƒä»¶**ã€‚ä¾‹å¦‚ç”¨ä¾†é¡¯ç¤ºåœ–ç‰‡çš„ `UIImageView` å°±ä¸éœ€è¦åç›¸ã€‚å°æ–¼å¤§éƒ¨åˆ†ä½¿ç”¨è€…ä¾†èªªï¼Œå¯ä»¥ç•¶ä½œä¸€å€‹ä¸éŒ¯çš„æ·±è‰²æ¨¡å¼æ›¿ä»£å“ã€‚

æŠŠæ™ºæ…§å‹åç›¸ç•¶ä½œæ·±è‰²æ¨¡å¼ä¾†æ€è€ƒçš„è©±ï¼Œé™¤äº†åœ–ç‰‡ä»¥å¤–ï¼Œåº•è‰²æ˜¯æ·±è‰²çš„ç•«é¢å°±å¯ä»¥å¿½ç•¥åç›¸ã€‚å¦‚æœ app æœ¬ä¾†å°±æ˜¯ä»¥æš—è‰²ç‚ºä¸»çš„ä»‹é¢ï¼Œé‚£å°±å¯ä»¥å…¨éƒ¨å¿½ç•¥ã€‚ä»¥æˆ‘å…¬å¸ CATCHPLAY çš„ app ç‚ºä¾‹ï¼Œæˆ‘å€‘çš„ä¸»é¡Œä¸€å‘æ˜¯æ·±è‰²ç‚ºä¸»ï¼Œå› æ­¤å¯ä»¥æŠŠæ‰€æœ‰çš„å…ƒä»¶éƒ½å¿½ç•¥æ‰æ™ºæ…§å‹åç›¸ã€‚

è¦æ”¯æ´æ™ºæ…§å‹åç›¸æ»¿ç°¡å–®çš„ï¼Œå°±æ˜¯æŠŠä¸è¦åç›¸çš„ `UIView` å…ƒä»¶çš„ [`accessibilityIgnoresInvertColors`](https://developer.apple.com/documentation/uikit/uiview/2865843-accessibilityignoresinvertcolors) è¨­ç‚º `true` å³å¯ã€‚

å¦‚æœæ•´å€‹ app éƒ½ä¸è¦åç›¸ï¼Œåœ¨ `UIApplicationDelegate` çš„ `didFinishLaunchingWithOptions` æ–¹æ³•è¨­å®š `UIView.appearance().accessibilityIgnoresInvertColors = true` å³å¯ã€‚

---
æ­£å¸¸çš„é¡è‰²ï¼š

![Normal](/assets/img/2018-10-30-cp-normal.png)

æ™ºæ…§å‹åç›¸çš„é è¨­çµæœï¼Œæ•ˆæœè·Ÿç¶“å…¸åç›¸ä¸€æ¨£ï¼š

![Enable Smart Invert](/assets/img/2018-10-30-enable-smart-invert.png)

æ•´å€‹ app çš„ UIView éƒ½å¿½ç•¥ç¶“å…¸åç›¸ï¼Œçœ‹èµ·ä¾†å¤§è‡´ç›¸åŒã€‚ç‹€æ…‹åˆ—çš„é¡è‰²ä»ç„¶æ˜¯åéä¾†çš„ï¼š

![Ignore Invert](/assets/img/2018-10-30-ignore-invert.png)

å¦‚æœåœ¨æ„ç‹€æ…‹åˆ—é¡è‰²çš„è©±ï¼Œå¯ä»¥ç›£è½ç³»çµ±é€šçŸ¥ [`invertColorsStatusDidChangeNotification`](https://developer.apple.com/documentation/uikit/uiaccessibility/1615196-invertcolorsstatusdidchangenotif)ï¼Œä¸¦ç”¨ [`UIAccessibility.isInvertColorsEnabled`](https://developer.apple.com/documentation/uikit/uiaccessibility/1615167-isinvertcolorsenabled) ä¾†åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦å•Ÿç”¨åç›¸ï¼Œç„¶å¾Œå†æŒ‡å®šç‹€æ…‹åˆ—çš„ styleã€‚é€™å€‹åˆ¤æ–·åç¨±é›–ç„¶æ²’æœ‰å¯« smartï¼Œä½†æ˜¯æˆ‘å¯¦æ¸¬å®ƒåªæœƒåœ¨æ™ºæ…§å‹åç›¸æ™‚å›å‚³ trueï¼Œåœ¨ç¶“å…¸åç›¸æ™‚å‰‡å›å‚³ falseã€‚

---
é›–ç„¶èªªå«åšæ™ºæ…§å‹åç›¸ï¼Œå…¶å¯¦ä¹Ÿæ²’æœ‰å¤šæ™ºæ…§ğŸ¤£ï¼Œå°±æ˜¯å¯ä»¥æŒ‡å®šéƒ¨åˆ† UI å…ƒä»¶ä¸è¦åç›¸è€Œå·²ã€‚ä¹Ÿè¨±ä½ é‚„æœƒæƒ³ï¼Œæ—¢ç„¶ç…§ç‰‡çš„é¡è‰²é¡›å€’ä¸å ªç”¨ï¼Œç‚ºä»€éº¼æ™ºæ…§å‹åç›¸æ™‚ï¼Œç³»çµ±æ²’æœ‰é è¨­æŠŠ `UIImageView` å¿½ç•¥æ‰å‘¢ï¼Ÿå¤§æ¦‚æ˜¯å› ç‚º `UIImageView` å¯ä»¥ç”¨ä¾†é¡¯ç¤ºç…§ç‰‡ï¼Œä¹Ÿå¯ä»¥ç”¨ä¾†é¡¯ç¤ºåœ–å½¢æŒ‰éˆ•ã€‚å³ä½¿ `UIImage` æœ‰ [`renderingMode`](https://developer.apple.com/documentation/uikit/uiimage/1624122-renderingmode) ä¹Ÿä¸å®¹æ˜“åˆ¤æ–·ï¼Œä¹¾è„†è®“é–‹ç™¼è€…è‡ªå·±æ±ºå®šã€‚å°±åƒå…¶ä»– accessibility åŠŸèƒ½ä¸€æ¨£ï¼Œç³»çµ±å¯ä»¥çŒœåˆ°å¤§æ¦‚ï¼Œæœ€å¾Œç´°ç¯€é‚„æ˜¯è¦ç•™çµ¦é–‹ç™¼è€…ã€‚

ä½†é€™ä¹Ÿå°è‡´çµ•å¤§å¤šæ•¸ app çš„åœ–ç‰‡åœ¨æ™ºæ…§å‹åç›¸é è¨­æƒ…æ³ä¸‹å¾ˆå¯æ€•ï¼Œå°±é€£ iOS 11 åˆæœŸç‰ˆæœ¬çš„ WebView èˆ‡éƒµä»¶ä¹Ÿæ²’[æ”¯æ´æ­£ç¢ºçš„ç…§ç‰‡é¡è‰²](https://support.apple.com/en-us/HT208067#113)ã€‚é–‹ç™¼è€…æ‡‰è©²æª¢æŸ¥ä¸€ä¸‹è‡ªå®¶çš„ app åœ¨æ™ºæ…§å‹åç›¸ä¸‹çš„æ•ˆæœã€‚

æœ€å¾Œæä¾›ä¸€å€‹é–‹ç™¼æˆ–æ¸¬è©¦çš„æ™‚å€™çš„å°æŠ€å·§ï¼Œå¯ä»¥åœ¨`ç³»çµ±è¨­å®š`â¡ï¸`ä¸€èˆ¬`â¡ï¸`è¼”åŠ©ä½¿ç”¨`â¡ï¸æœ€ä¸‹é¢çš„`è¼”åŠ©ä½¿ç”¨å¿«é€Ÿéµ`å‹¾é¸`æ™ºæ…§å‹åç›¸`ï¼Œé€™æ¨£æŒ‰ä¸‰ä¸‹è£ç½®çš„å¯¦é«”æŒ‰éˆ•ï¼Œå°±å¯ä»¥å¿«é€Ÿåˆ‡æ›ã€‚æ§åˆ¶ä¸­å¿ƒä¹Ÿå¯ä»¥æ”¾å…¥`è¼”åŠ©ä½¿ç”¨å¿«é€Ÿéµ`é …ç›®ã€‚

---
è£œå……è³‡æ–™ï¼š

> *iOS 12 ä¹Ÿæ–°å¢äº†è·Ÿ tvOS 10 ä¸€æ¨£çš„[`UIUserInterfaceStyle`](https://developer.apple.com/documentation/uikit/uiuserinterfacestyle)ï¼Œä½†æ˜¯æ²’æœ‰ä½œç”¨ã€‚

> é–‹å•Ÿæ™ºæ…§å‹åç›¸æ™‚ï¼Œåœ¨è£ç½®ä¸Šè¢å¹•æˆªåœ–é‚„æ˜¯æœƒæˆªå‡ºæ­£å¸¸çš„åœ–ç‰‡ã€‚å¦‚æœè¦æˆªåœ–çš„è©±è¦æ¥ä¸Šé›»è…¦ç”¨ Quick Time ä¾†æŠ“ã€‚

> `accessibilityIgnoresInvertColors` ä¹Ÿå¯ä»¥åœ¨ Interface Builder è¨­å®šï¼Œåœ¨ User Defined Runtime Attributes æ–°å¢ keyPath ä¸¦è¨­ç‚º `true` å³å¯ã€‚ç´°ç¯€å¯åƒè€ƒ[é€™ç¯‡æ–‡ç« ](https://duan.ca/2017/12/20/smart-invert-support-for-you-app/)ã€‚